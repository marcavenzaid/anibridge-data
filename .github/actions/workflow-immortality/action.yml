name: Workflow Immortality
description: Prevent GitHub from disabling scheduled workflows
inputs:
  GITHUB_TOKEN:
    required: false
    description: Token with actions: write permissions
runs:
  using: composite
  steps:
    - name: Re-enable workflow
      shell: sh
      env:
        GITHUB_TOKEN: ${{ inputs.GITHUB_TOKEN || github.token }}
      run: |
        case "${GITHUB_WORKFLOW_REF:?}" in
          "${GITHUB_REPOSITORY:?}"/.github/workflows/*.y*ml@*) ;;
          *) false ;;
        esac

        workflow="${GITHUB_WORKFLOW_REF%%@*}"
        workflow="${workflow#${GITHUB_REPOSITORY}/.github/workflows/}"

        gh api -X PUT \
          "repos/${GITHUB_REPOSITORY}/actions/workflows/${workflow}/enable"